# 进程
进程是具有一定独立功能的程序关于某个数据集合上的一次运行活动,进程是系统进行资源分配和调度的一个独立单位。每个进程都有自己的独立内存空间，不同进程通过进程间通信来通信。由于进程比较重量，占据独立的内存，所以上下文进程间的切换开销（栈、寄存器、虚拟内存、文件句柄等）比较大，但相对比较稳定安全。

## 僵尸进程
当子进程比父进程先结束，而父进程又没有回收子进程，释放子进程占用的资源，此时子进程将成为一个僵尸进程。

### 怎样来清除僵尸进程
改写父进程，在子进程死后要为它收尸。具体做法是接管 SIGCHLD 信号。子进程死后，会发送 SIGCHLD 信号给父进程，父进程收到此信号后，执行 waitpid()函数为子进程收尸。这是基于这样的原理：就算父进程没有调用 wait，内核也会向它发送 SIGCHLD 消息，尽管对的默认处理是忽略，如果想响应这个消息，可以设置一个处理函数。

把父进程杀掉。父进程死后，僵尸进程成为”孤儿进程”，过继给 1 号进程 init，init 始终会负责清理僵尸进程．它产生的所有僵尸进程也跟着消失。


# 线程
线程是进程的一个实体,是CPU调度和分派的基本单位,它是比进程更小的能独立运行的基本单位.线程自己基本上不拥有系统资源,只拥有一点在运行中必不可少的资源(如程序计数器,一组寄存器和栈),但是它可与同属一个进程的其他的线程共享进程所拥有的全部资源。线程间通信主要通过共享内存，上下文切换很快，资源开销较少，但相比进程不够稳定容易丢失数据。

# 协程
协程是一种用户态的轻量级线程，协程的调度完全由用户控制。协程拥有自己的寄存器上下文和栈。协程调度切换时，将寄存器上下文和栈保存到其他地方，在切回来的时候，恢复先前保存的寄存器上下文和栈，直接操作栈则基本没有内核切换的开销，可以不加锁的访问全局变量，所以上下文的切换非常快。

# 虚拟内存
虚拟内存是操作系统为每个进程提供的一种抽象，每个进程都有属于自己的，私有的、地址连续的虚拟内存，当然我们知道最终进程的数据
及代码必然要放到物理内存上，那么必须有某种机制能记住虚拟地址空间中的某个数据 被放到了那个物理内存地址上，这就是所谓的地址空间映射
，也就是虚拟内存地址与物理地址的映射关系，操作系统通过**页表**记住这种映射关系，页表中记录了虚拟内存地址到物理内存地址的映射关系。有了页表
就可以将虚拟地址转换为物理内存地址了，这种机制就是虚拟内存。

# 进程切换和线程切换的区别
进程切换与线程切换的一个最主要区别就在于**进程切换涉及到虚拟地址空间的切换而线程切换则不会**。因为每个进程都有自己的虚拟地址空间，而线程是共享所在进程的虚拟地址空间的，因此同一个进程中的线程进行线程切换时不涉及虚拟地址空间的转换。

# 为什么协程切换的代价比线程低
主要在于 线程切换需要借助内核完成，意味着 用户态 --> 内核态 --> 用户态，
而协程切换 只在用户态就可以完成， 用户态 --> 用户态

用户态和内核态的切换 是一部分的开销

切换频率，线程切换频率比协程切换的频率高很多， 因为协程库大多都在 IO 阻塞才切换

还有协程是串行的，线程是并行的，协程是自主让渡执行时间，而且都跑在一个核心上，不需要复杂的调度算法，不需要优先级管理，而线程，其自身不让渡核心时间，还有优先级。 操作系统需要像指挥交通那样指挥，所以耗时。

# 为什么虚拟地址切换很慢
现在我们已经知道了进程都有自己的虚拟地址空间，把虚拟地址转化为物理地址需要查找页表，页表查找是一个很慢的过程，因此通常使用Cache来缓存常用的地址映射，这样可以加速页表查找，这个Cache就是TLB，Translation Lookaside Buffer，我们不需要关心这个名字，只需要知道TLB本质上就是一
个cache，是用来加速页表查找的。由于每个进程都有自己的虚拟地址空间，那么显然每个进程都有自己的页表，那么当进程切换后页表也要进行切换，页表切换后TLB就失效了，cache失效导致命中率降低，那么虚拟地址转换为物理地址就会变慢，表现出来的就是程序运行会变慢，而线程切换不会导致TLB失效，因为线程无需切换地址空间，因此我们通常说线程切换比进程切换快，原因就在这里。

# 页表
## 构成
标志位（1 or 0） | 地址（物理地址）

1. 标志位为0，触发页缺失，根据地址在磁盘找到对应数据，牺牲一部分内存，将数据加载到内存中
2. 标志位为1，表明页命中，根据地址获取内存中数据

## 内存页置换算法
需要分配内存，而内存空间不足时，需要牺牲已在内存的页。

1. LRU（最近最少使用）：选择最近最长时间没有使用的页作为牺牲页。采用链表实现，最近使用过的为头节点，没有使用过的为尾节点，每次访问一个页找到对应的页面，移动到头节点。缺页发生时候，把链表末尾的页面淘汰。
2. FIFO（先进先出置换算法）：将驻留时间最长的内存页置换出去
3. OPT（最佳置换算法）

# 参考资料
[linux进程-线程-协程上下文环境的切换与实现](https://blog.csdn.net/runner668/article/details/80512664)

[操作系统：进程和线程 && CPU调度算法](https://blog.csdn.net/qq_43186095/article/details/103444402)