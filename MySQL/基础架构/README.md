# 基础架构
## 示意图
<img src="https://raw.githubusercontent.com/dark-tone/notes/main/MySQL/imgs/1.png" weight="633" height="475">

大体来说，MySQL 可以分为 Server 层和存储引擎层两部分。

Server 层包括连接器、查询缓存、分析器、优化器、执行器等，涵盖 MySQL 的大多数核心服务功能，以及所有的内置函数（如日期、时间、数学和加密函数等），所有跨存储引擎的功能都在这一层实现，比如存储过程、触发器、视图等。

而存储引擎层负责数据的存储和提取。其架构模式是插件式的，支持 InnoDB、MyISAM、Memory 等多个存储引擎。现在最常用的存储引擎是 InnoDB，它从 MySQL 5.5.5 版本开始成为了默认存储引擎。

## 连接器
**概念**：负责跟客户端建立连接、获取权限、维持和管理连接。<br>

客户端如果太长时间没动静，连接器就会自动将它断开。这个时间是由参数 wait_timeout 控制的，默认值是 8 小时。
建立连接的过程通常是比较复杂的，所以使用中要尽量减少建立连接的动作，也就是尽量使用长连接。（可以使用连接池来统一管理长连接）

## 查询缓存
不建议使用，因为只要对一个表进行更新，这个表上所有的查询缓存都会被清空。
MySQL 8.0直接将该功能移除了。

## 分析器
词法分析 → 语法分析（You have an error in your SQL syntax）

## 优化器
作用：在表里面有多个索引的时候，决定使用哪个索引；或者在一个语句有多表关联（join）的时候，决定各个表的连接顺序。

## 执行器
MySQL 通过分析器知道了你要做什么，通过优化器知道了该怎么做，于是就进入了执行器阶段，开始执行语句。

开始执行的时候，要先判断一下你对这个表 T 有没有执行查询的权限，如果没有，就会返回没有权限的错误(在工程实现上，如果命中查询缓存，会在查询缓存返回结果的时候，做权限验证。查询也会在优化器之前调用 precheck 验证权限)。

# 参考文章
[MySQL实战45讲](https://time.geekbang.org/column/article/68319)