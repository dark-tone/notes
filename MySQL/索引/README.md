# 索引
## 索引模型
InnoDB使用的是B+树索引模型。常见的模型如下：
> 在一堆已经排好序的数字当中找出一个特定的数字的最好办法是一种叫“二分查找”的方式，B/B+树可以看作是二叉树的变型。

### hash表
只有memory（内存）存储引擎支持哈希索引，哈希索引用索引列的值计算该值的hashCode，然后在hashCode相应的位置存执该值所在行数据的物理位置，因为使用散列算法，因此访问速度非常快，但是一个值只能对应一个hashCode，而且是散列的分布方式，因此哈希索引不支持范围查找和排序的功能。

### B-tree
BTree是平衡搜索多叉树，设树的度为2d（d>1），高度为h，那么BTree要满足以一下条件：
- 每个叶子结点的高度一样，等于h；
- 每个非叶子结点由n-1个key和n个指针point组成，其中d<=n<=2d,key和point相互间隔，结点两端一定是key；
- 叶子结点指针都为null；
- 非叶子结点的key都是[key,data]二元组，其中key表示作为索引的键，data为键值所在行的数据；

<img src="https://raw.githubusercontent.com/dark-tone/notes/main/MySQL/imgs/5.png" weight="708" height="287">

B树将一个节点的大小设为等于一个页（每页为4K），这样每个节点只需要一次I/O就可以完全载入。B-tree 的数据可以存在任何节点中。

### B+tree
B+Tree是BTree的一个变种，设d为树的度数，h为树的高度，B+Tree和BTree的不同主要在于：
- B+Tree中的非叶子结点不存储数据，只存储键值；
- B+Tree的叶子结点没有指针，所有键值都会出现在叶子结点上，且key存储的键值对应data数据的物理地址；
- B+Tree的每个非叶子节点由n个键值key和n个指针point组成；

<img src="https://raw.githubusercontent.com/dark-tone/notes/main/MySQL/imgs/4.png" weight="667" height="320">

### 为什么B+树比B树更适合作索引?
1. B+树的磁盘读写代价更低：B+树的内部节点并没有指向关键字具体信息的指针，因此其内部节点相对B树更小，如果把所有同一内部节点的关键字存放在同一盘块中，那么盘块所能容纳的关键字数量也越多，一次性读入内存的需要查找的关键字也就越多，相对IO读写次数就降低了。
    >附：空间局部性原理：如果一个存储器的某个位置被访问，那么将它附近的位置也会被访问。
2. B+树的查询效率更加稳定：由于非终结点并不是最终指向文件内容的结点，而只是叶子结点中关键字的索引。所以任何关键字的查找必须走一条从根结点到叶子结点的路。所有关键字查询的路径长度相同，导致每一个数据的查询效率相当。
3. 由于B+树的数据都存储在叶子结点中，分支结点均为索引，方便扫库，只需要扫一遍叶子结点即可，但是B树因为其分支结点同样存储着数据，我们要找到具体的数据，需要进行一次中序遍历按序来扫，所以B+树更加适合在区间查询的情况，所以通常B+树用于数据库索引。

## 相关的一些概念
### 最左前缀匹配原则
本质是因为联合索引的数据顺序是根据构成索引的字段进行排序的，那么如果要利用联合索引，查询的时候就需要从最左边进行匹配。
>常见问题：为什么like '%'无法使用索引，而like 'a%'能使用到索引

### 聚簇索引与非聚簇索引
主键索引的叶子节点存的是整行数据。在 InnoDB 里，主键索引也被称为聚簇索引（clustered index）。非主键索引的叶子节点内容是主键的值。在 InnoDB 里，非主键索引也被称为二级索引（secondary index）。
### 回表
利用非聚簇索引查到主键，再回到主键索引查询对应数据的情况称为回表（非覆盖索引情况）。

### 覆盖索引
搜索数据，而搜索的关键字刚好是组成索引的字段，此时不再需要回表查询数据，这种情况叫覆盖索引。

### 页分裂与页合并
插入数据时，如果插入位置所在的数据页已经满了，根据 B+ 树的算法，这时候需要申请一个新的数据页，然后挪动部分数据过去。这个过程称为页分裂。在这种情况下，性能自然会受影响。除了性能外，页分裂操作还影响数据页的利用率。原本放在一个页的数据，现在分到两个页中，整体空间利用率降低大约 50%。当然有分裂就有合并。当相邻两个页由于删除了数据，利用率很低之后，会将数据页做合并。合并的过程，可以认为是分裂过程的逆过程。


# 参考文章
《高性能MySQL》

《MySQL实战45讲》

[为什么MySQL数据库索引选择使用B+树？](https://www.cnblogs.com/tiancai/p/9024351.html)

[数据库索引为什么使用B+树？](https://www.jianshu.com/p/4dbbaaa200c4)

[深入理解MySQL索引原理和实现](https://blog.csdn.net/tongdanping/article/details/79878302/)