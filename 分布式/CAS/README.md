# 概念
Compare And Swap（对比 与 交换），是一种乐观锁机制（版本号控制也属于一种乐观锁机制）。
> 另外需要知道的是，CAS是系统原语，CAS操作是一条CPU的原子指令，所以不会有线程安全问题（硬件层面保证原子性）。

# 缺点
## 一次性只能保证一个共享变量的原子性
当对一个共享变量执行操作时，我们可以使用循环CAS的方式来保证原子操作，但是对多个共享量操作时，循环CAS就无法保证操作的原子性，这个时候就可以用锁来保证原子性。

## 循环会耗时
在并发冲突概率大的高竞争环境下，如果CAS一直失败，会一直重试，CPU开销较大。针对这个问题的一个思路是**引入退出机制**，如重试次数超过一定阈值后失败退出。当然，更重要的是**避免在高竞争环境下使用乐观锁**。

## ABA问题
> 一个线程把数据A变为了B，然后又重新变成了A。此时另外一个线程读取的时候，发现A没有变化，就误以为是原来的那个A。

**解决方案**：加入时间戳，或者类似于版本号的设计。操作时除了验证值还需要验证对应的时间戳。
