## 输入网址到显示页面发生了什么
1. 你向浏览器的地址栏输入一个域名回车，如http://www.baidu.com
2. 发起域名解析过程，获取真实IP地址。
    > 本地域名缓存、hosts文件、localDNS或httpDNS
3. 拿到ip地址之后，发起TCP 握手(3次)。
4. 握手成功，构造request,即 HTTP 中request请求.并发送到目的地。
    > 中间涉及局域网ARP协议获取网关MAC地址，以及路由规则，TCP流量控制及拥塞控制知识。
5. 服务器接受到一个完整的request(该边界的指定一般是conten-length,chunked也有),根据用户的request内容运算出相应的response。
6. 服务器将response 沿着request建立的连接，向浏览器(客户端)发送数据。
7. keepalive的时候不关闭该连接，没有keepalive的时候发起tcp close,4次握手
8. 浏览器根据接收到的response开始渲染页面。

至此，一个网页的打开过程完毕，我们从中提取出耗时的部分。
1. DNS查询时间(一来一回,走UDP协议) 网络IO
2. tcp 建立连接握手 网络IO
3. request构造时间(cpu运算)
4. request发送完毕时间(网络IO)
5. 服务器接收request运算构造response(CPU运算,特指构造response过程中没有任何IO操作)
6. 服务器发送response到客户端的时间(网络IO)
7. 服务器关闭连接时间(IO)
8. 客户端接收数据渲染页面时间(cpu运算)。

## 网络收发的数据传递
网络帧到达网卡，通过DMA复制到**环形缓冲区**，然后硬中断复制到内核数据结构**sk_buff 缓冲区**，sk_buff之后复制到**socket缓冲区**，应用程序通过系统调用将socket缓冲区数据复制到用户态内存空间。

**sk_buff 缓冲区**：是一个维护网络帧结构的双向链表，链表中的每一个元素都是一个网络帧（Packet）。虽然 TCP/IP 协议栈分了好几层，但上下不同层之间的传递，实际上只需要操作这个数据结构中的指针，而无需进行数据复制。

**套接字缓冲区**：允许应用程序给每个套接字配置不同大小的接收或发送缓冲区。应用程序发送数据，实际上就是将数据写入缓冲区；而接收数据，其实就是从缓冲区中读取。至于缓冲区中数据的进一步处理，则由传输层的 TCP 或 UDP 协议来完成。

实际上，sk_buff、套接字缓冲、连接跟踪等，都通过 slab 分配器来管理。你可以直接通过 /proc/slabinfo，来查看它们占用的内存大小。
