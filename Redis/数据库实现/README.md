# 数据库实现
Redis服务器将所有数据库都保存在服务器server.h/redisServer结构的db数组中，db数组每个项都是一个server.h/redisDb结构，每个redisDb结构代表一个数据库。初始化服务器时，会根据服务器状态的dbnum属性来决定应该创建多少个数据库。

## 数据库键空间
Redis是一个键值对(key-value pair)数据库服务器,服务器中的每个数据库都由一个server.h/redisDb结构表示,其中, redisDb结构的dict字典保存了数据库中的所有键值对,我们将这个字典称为键空间(key space)。

## 键过期相关
redisDb结构的expires字典保存了数据库中所有键的过期时间,我们称这个字典为过期字典。
1. 过期字典的键是一个指针，这个指针指向键空间中的某个键对象(也即是某个数据库键）。
2. 过期字典的值是一个long long类型的整数，这个整数保存了键所指向的数据库键的过期时间-一个毫秒精度的UNIX时间戳。

**带过期字典的数据库示例图：**<br>
<img src="https://raw.githubusercontent.com/dark-tone/notes/main/Redis/imgs/9-6.jpg" width="670" height="426"/>


#### 过期键的判断
1. 检查键是否存在于过期字典，存在则获取键的过期时间。
2. 坚持当前UNIX时间戳是否大于过期时间，大于则已过期。

#### 过期键删除策略
1. 定时删除：在设置键的过期时间的同时,创建一个定时器(timer),让定时器在键的过期时间来临时,立即执行对键的删除操作。（内存友好，CPU不友好）
2. 惰性删除：放任键过期不管,但是每次从键空间中获取键时,都检查取得的键是否过期,如果过期的话,就删除该键;如果没有过期,就返回该键。（内存不友好，CPU友好）
3. 定期删除：每隔一段时间,程序就对数据库进行一次检查,删除里面的过期键。至于要删除多少过期键,以及要检查多少个数据库,则由算法决定。（并不会遍历所有键，而是随机取一定数量键进行检查）

在这三种策略中,第一种和第三种为主动删除策略,而第二种则为被动删除策略。<br>
Redis服务器使用的是惰性删除和定期删除两种策略配合。

## 数据库通知（键空间通知）
（略）